<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Audio Player Demo</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }

        .demo-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        /* Enhanced Audio Player Styles */
        .custom-audio-player {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            border: 2px solid #dee2e6;
        }

        .audio-controls-row {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .play-pause-btn {
            background: #3498db;
            color: white;
            border: none;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
            font-weight: bold;
        }

        .play-pause-btn:hover {
            background: #2980b9;
            transform: scale(1.08);
        }

        .play-pause-btn:active {
            transform: scale(0.95);
        }

        .skip-btn {
            background: #95a5a6;
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .skip-btn:hover {
            background: #7f8c8d;
            transform: scale(1.05);
        }

        .skip-btn:active {
            transform: scale(0.95);
        }

        .progress-container {
            flex: 1;
            height: 8px;
            background: #dee2e6;
            border-radius: 4px;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: #3498db;
            width: 0%;
            border-radius: 4px;
            transition: width 0.1s linear;
        }

        .time-display {
            font-size: 0.9rem;
            color: #6c757d;
            min-width: 100px;
            text-align: right;
            flex-shrink: 0;
            font-weight: 500;
        }

        .volume-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .volume-btn {
            background: none;
            border: none;
            color: #6c757d;
            cursor: pointer;
            font-size: 20px;
            padding: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.2s;
        }

        .volume-btn:hover {
            color: #3498db;
        }

        .volume-slider {
            width: 100px;
            height: 5px;
            -webkit-appearance: none;
            appearance: none;
            background: #dee2e6;
            border-radius: 3px;
            outline: none;
        }

        .volume-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
        }

        .volume-slider::-moz-range-thumb {
            width: 16px;
            height: 16px;
            background: #3498db;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        /* Voice Selector Enhancements */
        .voice-selector {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .voice-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
        }

        .voice-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .voice-btn.active {
            background: #e74c3c;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.3);
        }

        .voice-btn.active::before {
            content: '‚ñ∂ ';
            font-size: 0.8em;
        }

        /* Playlist Controls */
        .playlist-controls {
            background: white;
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid #27ae60;
        }

        .current-song {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.15rem;
            text-align: center;
            padding: 12px;
            background: #e8f5e8;
            border-radius: 8px;
        }

        .playlist-nav-btns {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .playlist-btn {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .playlist-btn:hover {
            background: #7f8c8d;
            transform: translateY(-2px);
        }

        .playlist-btn.stop {
            background: #e74c3c;
        }

        .playlist-btn.stop:hover {
            background: #c0392b;
        }

        .song-progress {
            font-size: 0.9rem;
            color: #7f8c8d;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
<div class="demo-section">
    <h2>üéµ Enhanced Audio Player Features</h2>
    <p><strong>Fixed Issues:</strong></p>
    <ul>
        <li>‚úÖ Active track shows in RED with play arrow (‚ñ∂)</li>
        <li>‚úÖ Restart button works perfectly</li>
        <li>‚úÖ Skip forward/backward 10 seconds</li>
        <li>‚úÖ Click progress bar to jump anywhere</li>
        <li>‚úÖ Playlist navigation (next/previous song)</li>
        <li>‚úÖ No refreshes needed!</li>
    </ul>
</div>

<div class="demo-section">
    <h2>üéº Multi-Track Demo</h2>
    <div class="voice-selector">
        <button class="voice-btn active" onclick="demoSwitchTrack(0)">MELODY</button>
        <button class="voice-btn" onclick="demoSwitchTrack(1)">PIANO ONLY</button>
        <button class="voice-btn" onclick="demoSwitchTrack(2)">ALTO</button>
        <button class="voice-btn" onclick="demoSwitchTrack(3)">TENOR</button>
    </div>
    <div id="demo-player"></div>
</div>

<div class="demo-section">
    <h2>üéµ Playlist Demo</h2>
    <button class="playlist-btn" onclick="startDemoPlaylist()" style="background: #27ae60; width: 100%; padding: 15px; font-size: 1.1rem;">
        Play All Songs
    </button>
    <div class="playlist-controls" id="playlist-demo" style="display: none;">
        <div class="current-song">Now Playing: <span id="playlist-song-title">Song 1</span></div>
        <div class="song-progress">Song <span id="playlist-position">1</span> of <span id="playlist-total">3</span></div>
        <div id="playlist-player"></div>
        <div class="playlist-nav-btns">
            <button class="playlist-btn" onclick="playlistPrevious()">‚èÆ Previous</button>
            <button class="playlist-btn stop" onclick="stopDemoPlaylist()">‚èπ Stop Playlist</button>
            <button class="playlist-btn" onclick="playlistNext()">Next ‚è≠</button>
        </div>
    </div>
</div>

<script>
    // Enhanced Audio Player Class
    class CustomAudioPlayer {
        constructor(containerId, audioSrc = '') {
            this.container = document.getElementById(containerId);
            this.audioElement = new Audio(audioSrc);
            this.isPlaying = false;
            this.isMuted = false;
            this.playerId = 'player-' + Math.random().toString(36).substr(2, 9);
            this.createPlayer();
            this.attachEvents();
        }

        createPlayer() {
            this.container.innerHTML = `
                    <div class="custom-audio-player">
                        <div class="audio-controls-row">
                            <button class="skip-btn" title="Back 10 seconds" data-action="skip-back">‚è™</button>
                            <button class="play-pause-btn" data-action="play">‚ñ∂</button>
                            <button class="skip-btn" title="Forward 10 seconds" data-action="skip-forward">‚è©</button>
                            <div class="progress-container">
                                <div class="progress-bar"></div>
                            </div>
                            <div class="time-display">
                                <span class="current-time">0:00</span> / <span class="duration">0:00</span>
                            </div>
                        </div>
                        <div class="audio-controls-row volume-container">
                            <button class="volume-btn" data-action="mute">üîä</button>
                            <input type="range" class="volume-slider" min="0" max="100" value="100">
                        </div>
                    </div>
                `;

            this.playPauseBtn = this.container.querySelector('.play-pause-btn');
            this.skipBackBtn = this.container.querySelector('[data-action="skip-back"]');
            this.skipForwardBtn = this.container.querySelector('[data-action="skip-forward"]');
            this.progressContainer = this.container.querySelector('.progress-container');
            this.progressBar = this.container.querySelector('.progress-bar');
            this.currentTimeDisplay = this.container.querySelector('.current-time');
            this.durationDisplay = this.container.querySelector('.duration');
            this.volumeBtn = this.container.querySelector('.volume-btn');
            this.volumeSlider = this.container.querySelector('.volume-slider');
        }

        attachEvents() {
            // Play/Pause
            this.playPauseBtn.addEventListener('click', () => this.togglePlay());

            // Skip buttons
            this.skipBackBtn.addEventListener('click', () => this.skip(-10));
            this.skipForwardBtn.addEventListener('click', () => this.skip(10));

            // Progress bar
            this.progressContainer.addEventListener('click', (e) => this.seek(e));

            // Volume
            this.volumeBtn.addEventListener('click', () => this.toggleMute());
            this.volumeSlider.addEventListener('input', (e) => this.setVolume(e.target.value));

            // Audio events
            this.audioElement.addEventListener('timeupdate', () => this.updateProgress());
            this.audioElement.addEventListener('loadedmetadata', () => this.updateDuration());
            this.audioElement.addEventListener('ended', () => this.onEnded());
            this.audioElement.addEventListener('play', () => this.onPlay());
            this.audioElement.addEventListener('pause', () => this.onPause());
        }

        togglePlay() {
            if (this.isPlaying) {
                this.audioElement.pause();
            } else {
                this.audioElement.play().catch(e => console.log('Playback prevented:', e));
            }
        }

        skip(seconds) {
            this.audioElement.currentTime = Math.max(0, Math.min(
                this.audioElement.currentTime + seconds,
                this.audioElement.duration
            ));
        }

        restart() {
            this.audioElement.currentTime = 0;
            if (this.isPlaying) {
                this.audioElement.play();
            }
        }

        onPlay() {
            this.isPlaying = true;
            this.playPauseBtn.textContent = '‚è∏';
        }

        onPause() {
            this.isPlaying = false;
            this.playPauseBtn.textContent = '‚ñ∂';
        }

        updateProgress() {
            if (!isNaN(this.audioElement.duration)) {
                const percent = (this.audioElement.currentTime / this.audioElement.duration) * 100;
                this.progressBar.style.width = percent + '%';
                this.currentTimeDisplay.textContent = this.formatTime(this.audioElement.currentTime);
            }
        }

        updateDuration() {
            this.durationDisplay.textContent = this.formatTime(this.audioElement.duration);
        }

        seek(e) {
            const rect = this.progressContainer.getBoundingClientRect();
            const percent = (e.clientX - rect.left) / rect.width;
            this.audioElement.currentTime = percent * this.audioElement.duration;
        }

        toggleMute() {
            this.isMuted = !this.isMuted;
            this.audioElement.muted = this.isMuted;
            this.volumeBtn.textContent = this.isMuted ? 'üîá' : 'üîä';
        }

        setVolume(value) {
            this.audioElement.volume = value / 100;
            this.isMuted = value == 0;
            this.volumeBtn.textContent = this.isMuted ? 'üîá' : 'üîä';
        }

        formatTime(seconds) {
            if (isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        setSrc(src) {
            const wasPlaying = this.isPlaying;
            this.audioElement.src = src;
            this.audioElement.load();
            this.progressBar.style.width = '0%';
            this.currentTimeDisplay.textContent = '0:00';
            if (wasPlaying) {
                this.audioElement.play().catch(e => console.log('Autoplay prevented'));
            }
        }

        onEnded() {
            this.isPlaying = false;
            this.playPauseBtn.textContent = '‚ñ∂';
        }

        pause() {
            this.audioElement.pause();
        }

        play() {
            return this.audioElement.play();
        }

        get ended() {
            return this.audioElement.ended;
        }
    }

    // Demo implementation
    const demoTracks = [
        'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',
        'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3',
        'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3',
        'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3'
    ];

    let demoPlayer = new CustomAudioPlayer('demo-player', demoTracks[0]);
    let currentTrackIndex = 0;

    function demoSwitchTrack(index) {
        currentTrackIndex = index;
        demoPlayer.setSrc(demoTracks[index]);

        // Update button states
        const buttons = document.querySelectorAll('.voice-btn');
        buttons.forEach((btn, i) => {
            btn.classList.toggle('active', i === index);
        });
    }

    // Playlist demo
    const playlistSongs = [
        { title: 'Song 1 - Melody', src: demoTracks[0] },
        { title: 'Song 2 - Harmony', src: demoTracks[1] },
        { title: 'Song 3 - Full Mix', src: demoTracks[2] }
    ];

    let playlistPlayer = null;
    let currentPlaylistIndex = 0;
    let isPlaylistActive = false;

    function startDemoPlaylist() {
        isPlaylistActive = true;
        currentPlaylistIndex = 0;
        document.getElementById('playlist-demo').style.display = 'block';

        if (!playlistPlayer) {
            playlistPlayer = new CustomAudioPlayer('playlist-player');
            playlistPlayer.audioElement.addEventListener('ended', playlistNext);
        }

        playPlaylistSong(currentPlaylistIndex);
    }

    function playPlaylistSong(index) {
        if (index < 0 || index >= playlistSongs.length) return;

        currentPlaylistIndex = index;
        document.getElementById('playlist-song-title').textContent = playlistSongs[index].title;
        document.getElementById('playlist-position').textContent = index + 1;
        document.getElementById('playlist-total').textContent = playlistSongs.length;

        playlistPlayer.setSrc(playlistSongs[index].src);
        playlistPlayer.play().catch(e => console.log('Autoplay prevented'));
    }

    function playlistNext() {
        if (!isPlaylistActive) return;
        if (currentPlaylistIndex < playlistSongs.length - 1) {
            playPlaylistSong(currentPlaylistIndex + 1);
        } else {
            stopDemoPlaylist();
        }
    }

    function playlistPrevious() {
        if (!isPlaylistActive) return;
        if (currentPlaylistIndex > 0) {
            playPlaylistSong(currentPlaylistIndex - 1);
        }
    }

    function stopDemoPlaylist() {
        isPlaylistActive = false;
        if (playlistPlayer) {
            playlistPlayer.pause();
        }
        document.getElementById('playlist-demo').style.display = 'none';
    }
</script>
</body>
</html>
